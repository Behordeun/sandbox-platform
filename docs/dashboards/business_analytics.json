{
  "title": "Nigerian Startup Analytics",
  "panels": [
    {
      "type": "stat",
      "title": "Active Startups (7d)",
      "targets": [
        {
          "refId": "A",
          "datasource": {
            "type": "postgres",
            "uid": "postgres"
          },
          "rawSql": "SELECT COUNT(DISTINCT g.user_id) FROM gateway_access_logs g JOIN auth_users u ON g.user_id::int = u.id WHERE g.created_at>now()-interval '7 days' AND u.is_deleted=false;"
        }
      ],
      "gridPos": {"x": 0, "y": 0, "w": 6, "h": 4}
    },
    {
      "type": "stat",
      "title": "Total API Calls (7d)",
      "targets": [
        {
          "refId": "A",
          "datasource": {
            "type": "postgres",
            "uid": "postgres"
          },
          "rawSql": "SELECT COUNT(*) FROM gateway_access_logs WHERE created_at>now()-interval '7 days';"
        }
      ],
      "gridPos": {"x": 6, "y": 0, "w": 6, "h": 4}
    },
    {
      "type": "stat",
      "title": "Identity Verifications",
      "targets": [
        {
          "refId": "A",
          "datasource": {
            "type": "postgres",
            "uid": "postgres"
          },
          "rawSql": "SELECT COUNT(*) FROM gateway_access_logs WHERE created_at>now()-interval '7 days' AND (path LIKE '/nin/%' OR path LIKE '/bvn/%') AND status_code=200;"
        }
      ],
      "gridPos": {"x": 12, "y": 0, "w": 6, "h": 4}
    },
    {
      "type": "stat",
      "title": "SMS Messages Sent",
      "targets": [
        {
          "refId": "A",
          "datasource": {
            "type": "postgres",
            "uid": "postgres"
          },
          "rawSql": "SELECT COUNT(*) FROM gateway_access_logs WHERE created_at>now()-interval '7 days' AND path LIKE '/sms/%' AND status_code=200;"
        }
      ],
      "gridPos": {"x": 18, "y": 0, "w": 6, "h": 4}
    },
    {
      "type": "piechart",
      "title": "DPI Service Usage Distribution",
      "targets": [
        {
          "refId": "A",
          "datasource": {
            "type": "postgres",
            "uid": "postgres"
          },
          "rawSql": "SELECT CASE WHEN path LIKE '/nin/%' THEN 'NIN Verification' WHEN path LIKE '/bvn/%' THEN 'BVN Verification' WHEN path LIKE '/sms/%' THEN 'SMS Service' WHEN path LIKE '/llm/%' THEN 'AI/LLM Service' WHEN path LIKE '/auth/%' THEN 'Authentication' ELSE 'Other' END as service, COUNT(*) as usage FROM gateway_access_logs WHERE created_at>now()-interval '7 days' GROUP BY 1 ORDER BY usage DESC;"
        }
      ],
      "gridPos": {"x": 0, "y": 4, "w": 12, "h": 8}
    },
    {
      "type": "table",
      "title": "Top Nigerian Startups by API Usage",
      "targets": [
        {
          "refId": "A",
          "datasource": {
            "type": "postgres",
            "uid": "postgres"
          },
          "rawSql": "SELECT u.email as startup_email, u.first_name || ' ' || u.last_name as contact_name, COUNT(*) as total_calls, COUNT(CASE WHEN g.path LIKE '/nin/%' THEN 1 END) as nin_calls, COUNT(CASE WHEN g.path LIKE '/bvn/%' THEN 1 END) as bvn_calls, COUNT(CASE WHEN g.path LIKE '/sms/%' THEN 1 END) as sms_calls, COUNT(CASE WHEN g.path LIKE '/llm/%' THEN 1 END) as ai_calls, MAX(g.created_at) as last_activity FROM gateway_access_logs g JOIN auth_users u ON g.user_id::int = u.id WHERE g.created_at>now()-interval '30 days' AND u.is_deleted=false GROUP BY u.id, u.email, u.first_name, u.last_name ORDER BY total_calls DESC LIMIT 10;"
        }
      ],
      "gridPos": {"x": 12, "y": 4, "w": 12, "h": 8}
    },
    {
      "type": "timeseries",
      "title": "Daily API Usage Trends",
      "targets": [
        {
          "refId": "A",
          "datasource": {
            "type": "postgres",
            "uid": "postgres"
          },
          "rawSql": "SELECT date_trunc('day', created_at) as time, COUNT(*) as total_calls, COUNT(CASE WHEN path LIKE '/nin/%' THEN 1 END) as nin_calls, COUNT(CASE WHEN path LIKE '/bvn/%' THEN 1 END) as bvn_calls, COUNT(CASE WHEN path LIKE '/sms/%' THEN 1 END) as sms_calls, COUNT(CASE WHEN path LIKE '/llm/%' THEN 1 END) as ai_calls FROM gateway_access_logs WHERE created_at>now()-interval '30 days' GROUP BY 1 ORDER BY 1;"
        }
      ],
      "gridPos": {"x": 0, "y": 12, "w": 24, "h": 8}
    },
    {
      "type": "table",
      "title": "Nigerian Fintech Adoption Metrics",
      "targets": [
        {
          "refId": "A",
          "datasource": {
            "type": "postgres",
            "uid": "postgres"
          },
          "rawSql": "SELECT 'Identity Verification' as category, 'NIN + BVN Services' as service, COUNT(DISTINCT g.user_id) as active_startups, COUNT(*) as total_usage, ROUND(AVG(g.duration_ms), 2) as avg_response_ms FROM gateway_access_logs g WHERE g.created_at>now()-interval '7 days' AND (g.path LIKE '/nin/%' OR g.path LIKE '/bvn/%') UNION ALL SELECT 'Messaging', 'SMS Service', COUNT(DISTINCT g.user_id), COUNT(*), ROUND(AVG(g.duration_ms), 2) FROM gateway_access_logs g WHERE g.created_at>now()-interval '7 days' AND g.path LIKE '/sms/%' UNION ALL SELECT 'AI/ML', 'LLM Service', COUNT(DISTINCT g.user_id), COUNT(*), ROUND(AVG(g.duration_ms), 2) FROM gateway_access_logs g WHERE g.created_at>now()-interval '7 days' AND g.path LIKE '/llm/%';"
        }
      ],
      "gridPos": {"x": 0, "y": 20, "w": 24, "h": 6}
    },
    {
      "type": "heatmap",
      "title": "API Usage Heatmap (Hourly)",
      "targets": [
        {
          "refId": "A",
          "datasource": {
            "type": "postgres",
            "uid": "postgres"
          },
          "rawSql": "SELECT date_trunc('hour', created_at) as time, EXTRACT(hour FROM created_at) as hour, COUNT(*) as requests FROM gateway_access_logs WHERE created_at>now()-interval '7 days' GROUP BY 1, 2 ORDER BY 1;"
        }
      ],
      "gridPos": {"x": 0, "y": 26, "w": 24, "h": 8}
    }
  ],
  "time": {"from": "now-7d", "to": "now"},
  "schemaVersion": 38,
  "version": 1
}